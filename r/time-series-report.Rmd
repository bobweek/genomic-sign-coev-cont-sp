---
title: "host-parasite coevolution summary"
output:
  rmdformats::downcute:
    self_contained: true
    highlight: tango
    downcute_theme: "chaos"
editor_options: 
  chunk_output_type: console
---

<!-- <iframe src="https://player.vimeo.com/video/712261773?h=148675a6d9&loop=1&title=0&byline=0&portrait=0" width="320" height="160" frameborder="0" allow="autoplay; fullscreen; picture-in-picture" allowfullscreen></iframe> -->

```{r echo=F, message=FALSE, warning=FALSE,results='asis'}
require(ggplot2)
require(ggdark)

rnmclm = function(df){
  colnames(df) = c("iscaf")
  df
}

iscaf_cor = read.csv("~/gsccs-data/iscaf-cor-flat.csv")
iscaf_cov = read.csv("~/gsccs-data/iscaf-cov-flat.csv")
csl_iscaf_cor = read.csv("~/gsccs-data/csl-iscaf-cor-flat.csv")
csl_iscaf_cov = read.csv("~/gsccs-data/csl-iscaf-cov-flat.csv")

iscaf_cor = rnmclm(iscaf_cor)
iscaf_cov = rnmclm(iscaf_cov)
csl_iscaf_cor = rnmclm(csl_iscaf_cor)
csl_iscaf_cov = rnmclm(csl_iscaf_cov)

allkeeprs_cor = which(iscaf_cor!=0)
cslkeeprs_cor = which(csl_iscaf_cor!=0)

allkeeprs_cov = which(iscaf_cov!=0 & abs(iscaf_cov)>2e-5)
cslkeeprs_cov = which(csl_iscaf_cov!=0 & abs(csl_iscaf_cov)>2e-5)

lumpnms = c(rep("all",length(allkeeprs_cor)),rep("csl",length(cslkeeprs_cor)))
lumpcrs = c(iscaf_cor$iscaf[allkeeprs_cor],csl_iscaf_cor$iscaf[cslkeeprs_cor])
cor_df = data.frame(lumpcrs,lumpnms)
colnames(cor_df) = c("iscaf","set")

lumpnms = c(rep("all",length(allkeeprs_cov)),rep("csl",length(cslkeeprs_cov)))
lumpcvs = c(iscaf_cov$iscaf[allkeeprs_cov],csl_iscaf_cov$iscaf[cslkeeprs_cov])
cov_df = data.frame(lumpcvs,lumpnms)
colnames(cov_df) = c("iscaf","set")

lim_cor = max(abs(csl_iscaf_cor$iscaf))
lim_cov = max(abs(csl_iscaf_cov$iscaf))

ggplot(cor_df) + 
  geom_histogram(aes(x=iscaf,y=..density..,fill=set),bins=50,alpha=0.25) +
  # geom_point(data=csl_iscaf_cor_pt, aes(x=iscaf,y=y),color="red") +
  xlab("Interspecific Spatial Correlations") +
  ylab("Density") +
  xlim(c(-lim_cor,lim_cor)) +
  dark_theme_gray()
  
ggplot(cov_df) + 
  geom_histogram(aes(x=iscaf,y=..density..,fill=set),bins=50,alpha=0.25) +
  # geom_point(data=csl_iscaf_cov, aes(x=iscaf,y=0),color="red") +
  xlab("Interspecific Spatial Covariances") +
  ylab("Density") +
  xlim(c(-lim_cov,lim_cov)) +
  dark_theme_gray()

params = read.csv("~/gsccs-data/params.csv")
tsdf = read.csv("~/gsccs-data/time-series.csv")

colors <- c("Parasite" = "purple", "Host" = "orange")

ggplot(tsdf) + 
  geom_line(aes(x=t,y=Nh,color="Host")) +
  geom_line(aes(x=t,y=Np,color="Parasite")) +
  labs(x = "Time",        
       y = "Global Census Size",        
       color = "Legend") +   
  scale_color_manual(values = colors) +
  dark_theme_gray()

ggplot(tsdf) + 
  geom_line(aes(x=t,y=zh,color="Host")) +
  geom_line(aes(x=t,y=zp,color="Parasite")) +
  labs(x = "Time",        
       y = "Global Trait Means",        
       color = "Legend") +   
  scale_color_manual(values = colors) +
  dark_theme_gray()

ggplot(tsdf) + 
  geom_line(aes(x=t,y=vh,color="Host")) +
  geom_line(aes(x=t,y=vp,color="Parasite")) +
  labs(x = "Time",        
       y = "Global Trait Stddevs",        
       color = "Legend") +   
  scale_color_manual(values = colors) +
  dark_theme_gray()

ggplot(tsdf) + 
  geom_line(aes(x=t,y=muh,color="Host")) +
  geom_line(aes(x=t,y=mup,color="Parasite")) +
  labs(x = "Time",
       y = "Num Polymorphic Loci") +   
  scale_color_manual(values = colors) +
  dark_theme_gray()

ggplot(tsdf) + 
  geom_line(aes(x=t,y=pntcorr)) +
  labs(x = "Time",        
       y = "Spatial Correlation of Traits",        
       color = "Legend") +   
  scale_color_manual(values = colors) +
  ylim(c(-1,1)) +
  dark_theme_gray()

ggplot(tsdf) + 
  geom_line(aes(x=t,y=abar)) +
  labs(x = "Time",
       y = "Average Infection Probability",        
       color = "Legend") +   
  scale_color_manual(values = colors) +
  dark_theme_gray()

# ggplot(tsdf) + 
#   geom_line(aes(x=t,y=vara)) +
#   labs(x = "Time",        
#        y = "Variance of Infection Probability",
#        color = "Legend") +   
#   scale_color_manual(values = colors) +
#   dark_theme_gray()

ggplot(tsdf) + 
  geom_line(aes(x=t,y=hselresp)) +
  labs(x = "Time",        
       y = "Host Response to Biotic Selection",        
       color = "Legend") +   
  scale_color_manual(values = colors) +
  dark_theme_gray()

ggplot(tsdf) + 
  geom_line(aes(x=t,y=pselresp)) +
  labs(x = "Time",        
       y = "Parasite Response to Biotic Selection",
       color = "Legend") +   
  scale_color_manual(values = colors) +
  dark_theme_gray()

ggplot(tsdf) + 
  geom_line(aes(x=t,y=(1-pr_unparasitized),color="Host")) +
  geom_line(aes(x=t,y=(1-pr_unhosted),color="Parasite")) +
  labs(x = "Time",        
       y = "Proportion Interaction Attempted",        
       color = "Legend") +   
  scale_color_manual(values = colors) +
  ylim(c(0,1)) +
  dark_theme_gray()

descrs = c("host mutation rate","parasite mutation rate","host mutation effect size","parasite mutation effect size",
           "host dispersal distance","parasite dispersal distance","host-parasite interaction dist","host competition",
           "parasite competition","host competition dist","parasite competition dist","host base fitness","parasite base fitness",
           "host biotic selection","parasite biotic selection","infection probability sensitivity","host initial density",
           "parasite initial density","temporal resolution of time-series")
txtdat = cbind(colnames(params),descrs,formatC(as.numeric(params), digits = 1, format = "e", drop0trailing = FALSE))
txtdf = data.frame(txtdat)
colnames(txtdf) = c("Param","Description","Value")

knitr::kable(txtdf)
```
